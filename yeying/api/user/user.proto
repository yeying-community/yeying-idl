syntax = "proto3";
option go_package = "yeying/api/user";
package yeying.api.user;

import "yeying/api/common/message.proto";

service User {
  // 通用请求
  rpc Search(SearchRequest) returns(SearchResponse) {}
  rpc Add(AddRequest) returns(AddResponse) {}
  rpc Get(GetRequest) returns(GetResponse) {}
  rpc Del(DelRequest) returns(DelResponse) {}
  rpc Mod(ModRequest) returns(ModResponse) {}
  // 通常owner才可以发送命令，帮助服务提供者做决策
  rpc Command(CommandRequest) returns(CommandResponse) {}
}

message UserMetadata {
  string name = 1;
  string did = 2;
  UserRoleEnum role = 3;
  string extend = 4;
  UserStatusEnum status = 5;
  string created = 6;
  string checkpoint = 7;
}

message AddRequest {
  string name = 1;
  string did = 2;
  string extend = 3;
  string created = 4;
  string checkpoint = 5;
}

message AddResponse {
  common.ResponseStatus status = 1;
  UserMetadata user = 2;
}

message ModRequest {
  string did = 1;
  string extend = 2;
  string checkpoint = 3;
}

message ModResponse {
  common.ResponseStatus status = 1;
  UserMetadata user = 2;
}

message DelRequest {
  string did = 1;
}

message DelResponse {
  common.ResponseStatus status = 1;
  UserMetadata user = 2;
}

message GetRequest {
  string did = 1;
}

message GetResponse {
  common.ResponseStatus status = 1;
  UserMetadata user = 2;
}

message Invitation {
  string scene = 1;
  string code = 2;
  string expiredTime = 3;
  string inviter = 4;
  string invitee = 5;
}

message SearchRequest {
  string did = 1;
  Condition condition = 2;
}

message Condition {
  UserStatusEnum status = 1;
}

message SearchResponse {
  common.ResponseStatus status = 1;
  repeated UserMetadata users = 2;
}

message CommandRequest {
  // 命令者身份DID
  string did = 1;
  // 命令编码
  CommandCodeEnum commandCode = 2;
  oneof subCommand {
    TaskOpinion taskOpinion = 3;
    InputInvitationCode inputInvitationCode = 4;
  }
}

message InputInvitationCode {
  string code = 1;
}

message TaskOpinion {
  // 任务ID
  string taskId = 1;
  // 任务意见
  string opinion = 2;
}

message FetchTaskResponse {
  // 任务元信息
  repeated TaskMetadata tasks = 1;
}

message TaskMetadata {
  // 任务Id
  string uid = 1;
  // 任务编码
  TaskCodeEnum code = 2;
  // 任务创建者，通常是服务自己
  string creator = 3;
  // 任务参与，比如申请者
  string participant = 4;
  // 任务结束者, 比如yes or no类型的任务，需要做个选者，以结束任务
  string terminator = 5;
  // 创建时间
  string created = 6;
  // 任务内容
  string content = 7;
}

message GenerateInvitationResponse {
  repeated Invitation invitations = 1;
}

message GetStateResponse {
  string state = 1;
}

message UserOpinion {
  // 任务ID
  string taskId = 1;
  // 任务意见
  string opinion = 2;
}

message CommandResponse {
  common.ResponseStatus status = 1;
  oneof data {
    FetchTaskResponse fetchTaskResponse = 2;
    GenerateInvitationResponse generateInvitationResponse = 3;
    GetStateResponse getStateResponse = 4;
  }
}

enum CommandCodeEnum {
  // 未知编码，是一种占位符
  COMMAND_CODE_UNKNOWN = 0;

  // 获取任务
  COMMAND_CODE_FETCH_TASK = 1;

  // 生成邀请码
  COMMAND_CODE_GENERATE_INVITATION = 2;

  // 输入邀请码
  COMMAND_CODE_INPUT_INVITATION = 3;

  // 给出意见
  COMMAND_CODE_PROVIDE_OPINION = 4;
}

enum UserStatusEnum {
  // 未知编码，是一种占位符
  USER_STATUS_UNKNOWN = 0;

  // 活跃：表示用户目前正在使用软件并与其进行交互
  USER_STATUS_ACTIVE = 1;

  // 离线：表示用户当前不处于活跃状态，但可能会随时返回
  USER_STATUS_OFFLINE = 2;

  // 禁用：表示用户的访问权限被暂时或永久性地限制
  USER_STATUS_DISABLE = 3;

  // 锁定：表示用户的账户被暂时性地冻结，通常是由于安全原因
  USER_STATUS_LOCK = 4;

  // 未验证：表示用户账户在创建后尚未通过验证
  USER_STATUS_UNVERIFIED = 5;

  // 删除：表示用户账户已经被永久删除，无法恢复
  USER_STATUS_DELETED = 6;

  // 休眠：表示用户账户由于长时间未活跃而被标记为休眠状态
  USER_STATUS_DORMANT = 7;

  // 冻结：表示用户账户在一段时间内暂时不可用
  USER_STATUS_FREEZE = 8;

  // 待审核：表示新用户注册后正在等待管理员或审核人员审批
  USER_STATUS_AUDIT = 9;

  // 审核未通过：表示管理员或审核人员拒绝了用户的注册请求
  USER_STATUS_REFUSED = 10;
}

enum UserRoleEnum {
  // 未知编码，是一种占位符
  USER_ROLE_UNKNOWN = 0;

  // 所有者
  USER_ROLE_OWNER = 2;

  // 普通用户
  USER_ROLE_NORMAL = 1;
}

enum TaskCodeEnum {
  // 未知编码，是一种占位符
  TASK_CODE_UNKNOWN = 0;

  // 任务编码
  TASK_CODE_YES_OR_NO = 1;
}