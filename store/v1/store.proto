syntax = "proto3";
option go_package = "store/v1";

import "google/api/annotations.proto";

service Store {
  rpc Metadata(MetadataRequest) returns (MetadataResponse) {
    option (google.api.http) = {
      get: "/api/v1/store/metadata"
    };
  }

  rpc Put(stream PutRequest) returns (PutResponse) {
    option (google.api.http) = {
      post: "/api/v1/store"
      body: "*"
    };
  }

  rpc Get(GetRequest) returns (stream GetResponse) {
    option (google.api.http) = {
      get: "/api/v1/store"
    };
  }

  rpc Del(DelRequest) returns (DelResponse) {
    option (google.api.http) = {
      delete: "/api/v1/store"
    };
  }
}

message Identity {
  string did = 1;
}

message Asset {
  Namespace namespace = 1;
  string name = 2;
  string hash = 3;
  string type = 4;
  uint64 size = 5;
  uint64 created = 6;
  uint64 timestamp = 7;
}

message Namespace {
  Identity owner = 1;
  string path = 2;
}

message Result {
  uint32 code = 1;
  string message = 2;
}

message MetadataRequest {
  Namespace namespace = 1;
  bool recursive = 2;
}

message MetadataResponse {
  Namespace namespace = 1;
  repeated FileMetadata files = 2;
}

message FileMetadata {
  string isDirectory = 1;
  string name = 2;
  string hash = 3;
  string type = 4;
  bool encrypted = 5;
  int64 timestamp = 6;
  repeated FileMetadata files = 7;
}

message PutRequest {
  oneof data {
    Asset asset = 1;
    bytes chunk = 2;
  }
}

message PutResponse {
  Result result = 1;
  Asset asset = 2;
}

message GetRequest {
  Namespace namespace = 1;
  string hash = 2;
}

message GetResponse {
  oneof data {
    Result result = 1;
    bytes chunk = 2;
  }
}

message DelRequest {
  Namespace namespace = 1;
  string hash = 2;
}

message DelResponse {
  Result result = 1;
}
